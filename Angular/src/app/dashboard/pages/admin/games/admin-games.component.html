<div class="games-container">
    <div class="header">
        <h2>Monitoreo de Partidas</h2>
        <div class="total">{{ games.length }} partidas encontradas</div>
    </div>

    <div class="filters-bar shadow-sm">
        <div class="filter-group">
            <i class="fas fa-search"></i>
            <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="applyFilters()"
                placeholder="Buscar por cuestionario o profesor...">
        </div>

        <div class="filter-group select">
            <select [(ngModel)]="statusFilter" (change)="applyFilters()">
                <option value="">Todos los estados</option>
                <option value="espera">En espera</option>
                <option value="activa">En vivo</option>
                <option value="finalizada">Finalizada</option>
            </select>
        </div>

        <div class="filter-group date">
            <input type="date" [(ngModel)]="dateFilter" (change)="applyFilters()">
        </div>

        <div class="total-badge">{{ filteredGames.length }} partidas</div>
    </div>

    <div class="table-container shadow-sm">
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Cuestionario</th>
                    <th>Profesor</th>
                    <th>Estado</th>
                    <th>Creada</th>
                    <th>Finalizada</th>
                    <th>PIN</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let g of filteredGames">
                    <td>
                        <strong>{{ g.idCuestionario?.titulo || 'N/A' }}</strong>
                    </td>
                    <td>{{ g.profesor?.nombre }}</td>
                    <td>
                        <span class="badge" [ngClass]="getStatusBadgeClass(g.estadoPartida)">
                            {{ g.estadoPartida }}
                        </span>
                    </td>
                    <td>{{ g.fechas?.creadaEn | date:'short' }}</td>
                    <td>
                        <span *ngIf="g.fechas?.finalizadaEn; else running">
                            {{ g.fechas.finalizadaEn | date:'short' }}
                        </span>
                        <ng-template #running>
                            <span class="text-muted small">--</span>
                        </ng-template>
                    </td>
                    <td><code>{{ g.pin }}</code></td>
                    <td class="actions-cell">
                        <button class="btn-action edit" (click)="openConfig(g)" title="Editar Configuración">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="btn-action delete" (click)="deleteGame(g._id)" title="Eliminar Partida">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Modal de Configuración -->
    <div class="modal-overlay" *ngIf="showConfigModal" (click)="closeConfigModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>Configuración de Partida: {{ selectedGame.pin }}</h3>
                <button class="close-btn" (click)="closeConfigModal()">&times;</button>
            </div>

            <div class="modal-body" *ngIf="selectedGame">
                <div class="config-section">
                    <h4>Datos Generales</h4>
                    <div class="form-group">
                        <label>Nombre de la Partida</label>
                        <input type="text" [(ngModel)]="selectedGame.nombrePartida">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Asignatura</label>
                            <input type="text" [(ngModel)]="selectedGame.asignatura">
                        </div>
                        <div class="form-group">
                            <label>Curso</label>
                            <input type="text" [(ngModel)]="selectedGame.curso">
                        </div>
                    </div>
                </div>

                <div class="config-section" *ngIf="selectedGame.tipoPartida === 'en_vivo'">
                    <h4>Opciones En Vivo</h4>
                    <div class="form-group-checkbox">
                        <label><input type="checkbox" [(ngModel)]="selectedGame.configuracionEnvivo.mostrarRanking">
                            Mostrar Ranking</label>
                    </div>
                    <div class="form-group-checkbox">
                        <label><input type="checkbox" [(ngModel)]="selectedGame.configuracionEnvivo.mezclarPreguntas">
                            Mezclar Preguntas</label>
                    </div>
                    <div class="form-group-checkbox">
                        <label><input type="checkbox" [(ngModel)]="selectedGame.configuracionEnvivo.mezclarRespuestas">
                            Mezclar Respuestas</label>
                    </div>
                    <div class="form-group">
                        <label>Tiempo por pregunta (seg)</label>
                        <input type="number" [(ngModel)]="selectedGame.configuracionEnvivo.tiempoPorPreguntaSeg">
                    </div>
                </div>

                <div class="config-section" *ngIf="selectedGame.tipoPartida === 'examen'">
                    <h4>Opciones de Examen</h4>
                    <div class="form-group">
                        <label>Tiempo total (min)</label>
                        <input type="number" [(ngModel)]="selectedGame.configuracionExamen.tiempoTotalMin">
                    </div>
                    <div class="form-group-checkbox">
                        <label><input type="checkbox" [(ngModel)]="selectedGame.configuracionExamen.permitirNavegacion">
                            Permitir Navegación</label>
                    </div>
                    <div class="form-group-checkbox">
                        <label><input type="checkbox" [(ngModel)]="selectedGame.configuracionExamen.envioAutomatico">
                            Envío Automático</label>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="closeConfigModal()">Cancelar</button>
                <button class="btn btn-primary" (click)="saveConfig()" [disabled]="isSaving">
                    {{ isSaving ? 'Guardando...' : 'Guardar Cambios' }}
                </button>
            </div>
        </div>
    </div>
</div>